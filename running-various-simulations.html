<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>6 Running Various Simulations | Rolling Dice with R</title>
  <meta name="description" content="<p>This tutorial describes a couple of examples for implementing simulations
of games of chance in R.</p>" />
  <meta name="generator" content="bookdown 0.29 and GitBook 2.6.7" />

  <meta property="og:title" content="6 Running Various Simulations | Rolling Dice with R" />
  <meta property="og:type" content="book" />
  <meta property="og:image" content="https://www.gastonsanchez.com/R-rolling-dice/images/demere-cover.png" />
  <meta property="og:description" content="<p>This tutorial describes a couple of examples for implementing simulations
of games of chance in R.</p>" />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="6 Running Various Simulations | Rolling Dice with R" />
  
  <meta name="twitter:description" content="<p>This tutorial describes a couple of examples for implementing simulations
of games of chance in R.</p>" />
  <meta name="twitter:image" content="https://www.gastonsanchez.com/R-rolling-dice/images/demere-cover.png" />

<meta name="author" content="Gaston Sanchez" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="playing-game1-100times.html"/>
<link rel="next" href="running-even-more-simulations.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./"><b>Rolling Dice with R</b><br><small>Gaston Sanchez</small></a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>About</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#my-series-of-r-tutorials"><i class="fa fa-check"></i>My Series of R Tutorials</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#donation"><i class="fa fa-check"></i>Donation</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#license"><i class="fa fa-check"></i>License</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="introduction.html"><a href="introduction.html"><i class="fa fa-check"></i><b>1</b> Introduction</a>
<ul>
<li class="chapter" data-level="1.1" data-path="introduction.html"><a href="introduction.html#description-of-game-a"><i class="fa fa-check"></i><b>1.1</b> Description of Game-A</a></li>
<li class="chapter" data-level="1.2" data-path="introduction.html"><a href="introduction.html#probability-of-winning-game-a"><i class="fa fa-check"></i><b>1.2</b> Probability of winning Game-A</a>
<ul>
<li class="chapter" data-level="1.2.1" data-path="introduction.html"><a href="introduction.html#no-six-in-four-rolls"><i class="fa fa-check"></i><b>1.2.1</b> No six in four rolls</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="coding-game-a.html"><a href="coding-game-a.html"><i class="fa fa-check"></i><b>2</b> Coding Game-A</a>
<ul>
<li class="chapter" data-level="2.1" data-path="coding-game-a.html"><a href="coding-game-a.html#rolling-one-die"><i class="fa fa-check"></i><b>2.1</b> Rolling one die</a></li>
<li class="chapter" data-level="2.2" data-path="coding-game-a.html"><a href="coding-game-a.html#rolling-dice-with-sample"><i class="fa fa-check"></i><b>2.2</b> Rolling dice with <code>sample()</code></a></li>
<li class="chapter" data-level="2.3" data-path="coding-game-a.html"><a href="coding-game-a.html#rolling-four-dice"><i class="fa fa-check"></i><b>2.3</b> Rolling four dice</a></li>
<li class="chapter" data-level="2.4" data-path="coding-game-a.html"><a href="coding-game-a.html#playing-game-a-once"><i class="fa fa-check"></i><b>2.4</b> Playing Game-A once</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="playing-game-a-a-few-times.html"><a href="playing-game-a-a-few-times.html"><i class="fa fa-check"></i><b>3</b> Playing Game-A a Few Times</a>
<ul>
<li class="chapter" data-level="3.1" data-path="playing-game-a-a-few-times.html"><a href="playing-game-a-a-few-times.html#playing-game-a-five-times"><i class="fa fa-check"></i><b>3.1</b> Playing Game-A Five Times</a></li>
<li class="chapter" data-level="3.2" data-path="playing-game-a-a-few-times.html"><a href="playing-game-a-a-few-times.html#using-a-for-loop"><i class="fa fa-check"></i><b>3.2</b> Using a <code>for()</code> loop</a></li>
<li class="chapter" data-level="3.3" data-path="playing-game-a-a-few-times.html"><a href="playing-game-a-a-few-times.html#playing-game-a-10-times"><i class="fa fa-check"></i><b>3.3</b> Playing Game-A 10 times</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="vectorized-loops-with-apply.html"><a href="vectorized-loops-with-apply.html"><i class="fa fa-check"></i><b>4</b> Vectorized loops with <code>apply()</code></a>
<ul>
<li class="chapter" data-level="4.1" data-path="vectorized-loops-with-apply.html"><a href="vectorized-loops-with-apply.html#function-apply"><i class="fa fa-check"></i><b>4.1</b> Function <code>apply()</code></a></li>
<li class="chapter" data-level="4.2" data-path="vectorized-loops-with-apply.html"><a href="vectorized-loops-with-apply.html#anonymous-functions-and-apply"><i class="fa fa-check"></i><b>4.2</b> Anonymous functions and <code>apply()</code></a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="vectorized-loops-with-apply.html"><a href="vectorized-loops-with-apply.html#number-of-wins-with-apply"><i class="fa fa-check"></i><b>4.2.1</b> Number of wins with <code>apply()</code></a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="playing-game1-100times.html"><a href="playing-game1-100times.html"><i class="fa fa-check"></i><b>5</b> Playing Game-A 100 times</a>
<ul>
<li class="chapter" data-level="5.1" data-path="playing-game1-100times.html"><a href="playing-game1-100times.html#computing-cumulative-gains"><i class="fa fa-check"></i><b>5.1</b> Computing Cumulative Gains</a></li>
<li class="chapter" data-level="5.2" data-path="playing-game1-100times.html"><a href="playing-game1-100times.html#plotting-cumulative-gains"><i class="fa fa-check"></i><b>5.2</b> Plotting Cumulative Gains</a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="playing-game1-100times.html"><a href="playing-game1-100times.html#cumulative-gains-with-plot"><i class="fa fa-check"></i><b>5.2.1</b> Cumulative Gains with <code>plot()</code></a></li>
<li class="chapter" data-level="5.2.2" data-path="playing-game1-100times.html"><a href="playing-game1-100times.html#cum-gains-ggplot"><i class="fa fa-check"></i><b>5.2.2</b> Cumulative Gains with <code>ggplot2</code></a></li>
<li class="chapter" data-level="5.2.3" data-path="playing-game1-100times.html"><a href="playing-game1-100times.html#animated-ggplot-graphic"><i class="fa fa-check"></i><b>5.2.3</b> Animated ggplot graphic</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="running-various-simulations.html"><a href="running-various-simulations.html"><i class="fa fa-check"></i><b>6</b> Running Various Simulations</a>
<ul>
<li class="chapter" data-level="6.1" data-path="running-various-simulations.html"><a href="running-various-simulations.html#embedded-for-loops"><i class="fa fa-check"></i><b>6.1</b> Embedded <code>for()</code> loops</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="running-even-more-simulations.html"><a href="running-even-more-simulations.html"><i class="fa fa-check"></i><b>7</b> Running Even More Simulations</a>
<ul>
<li class="chapter" data-level="7.1" data-path="running-even-more-simulations.html"><a href="running-even-more-simulations.html#graphing-cumulative-gains"><i class="fa fa-check"></i><b>7.1</b> Graphing Cumulative Gains</a>
<ul>
<li class="chapter" data-level="7.1.1" data-path="running-even-more-simulations.html"><a href="running-even-more-simulations.html#plotting-the-first-simulation"><i class="fa fa-check"></i><b>7.1.1</b> Plotting the first simulation</a></li>
<li class="chapter" data-level="7.1.2" data-path="running-even-more-simulations.html"><a href="running-even-more-simulations.html#plotting-the-first-four-simulations"><i class="fa fa-check"></i><b>7.1.2</b> Plotting the first four simulations</a></li>
<li class="chapter" data-level="7.1.3" data-path="running-even-more-simulations.html"><a href="running-even-more-simulations.html#plotting-all-simulations"><i class="fa fa-check"></i><b>7.1.3</b> Plotting all simulations</a></li>
</ul></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://www.gastonsanchez.com" target="_blank">gastonsanchez.com</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Rolling Dice with R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="running-various-simulations" class="section level1 hasAnchor" number="6">
<h1><span class="header-section-number">6</span> Running Various Simulations<a href="running-various-simulations.html#running-various-simulations" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>A single series of 100 games may not be enough to fully
understand the probability behavior of Game-A. So let’s see how to run various
simulations, all of them involving playing 100 games.</p>
<p><strong>Let’s start small</strong>. Meaning, let’s begin with a handful of games, and a few
simulations. This will allow us to get a better idea of the objects and
commands we need to use in order to later generalize things with more games
and simulations.</p>
<p>Our starting point will involve 3 simulations, each one consisting of 5 games
as illustrated in the picture below.</p>
<p><img src="images/demere-3-simulations.png" width="80%" style="display: block; margin: auto;" /></p>
<p>Here’s some naive code to run these simulations. We are momentarily considering
this piece of code to get a high-level intuition of the things we might need
later to write more efficient commands.</p>
<div class="sourceCode" id="cb80"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb80-1"><a href="running-various-simulations.html#cb80-1" aria-hidden="true" tabindex="-1"></a><span class="co"># -------------------------------------</span></span>
<span id="cb80-2"><a href="running-various-simulations.html#cb80-2" aria-hidden="true" tabindex="-1"></a><span class="co"># three simulations, each of 5 games</span></span>
<span id="cb80-3"><a href="running-various-simulations.html#cb80-3" aria-hidden="true" tabindex="-1"></a><span class="co"># -------------------------------------</span></span>
<span id="cb80-4"><a href="running-various-simulations.html#cb80-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-5"><a href="running-various-simulations.html#cb80-5" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">753</span>)</span>
<span id="cb80-6"><a href="running-various-simulations.html#cb80-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-7"><a href="running-various-simulations.html#cb80-7" aria-hidden="true" tabindex="-1"></a><span class="co"># main inputs</span></span>
<span id="cb80-8"><a href="running-various-simulations.html#cb80-8" aria-hidden="true" tabindex="-1"></a>die <span class="ot">=</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">6</span></span>
<span id="cb80-9"><a href="running-various-simulations.html#cb80-9" aria-hidden="true" tabindex="-1"></a>number_games <span class="ot">=</span> <span class="dv">5</span></span>
<span id="cb80-10"><a href="running-various-simulations.html#cb80-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-11"><a href="running-various-simulations.html#cb80-11" aria-hidden="true" tabindex="-1"></a><span class="co"># simulation 1</span></span>
<span id="cb80-12"><a href="running-various-simulations.html#cb80-12" aria-hidden="true" tabindex="-1"></a>games_sim1 <span class="ot">=</span> <span class="fu">matrix</span>(<span class="dv">0</span>, <span class="at">nrow =</span> number_games, <span class="at">ncol =</span> <span class="dv">4</span>)</span>
<span id="cb80-13"><a href="running-various-simulations.html#cb80-13" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (game <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>number_games) {</span>
<span id="cb80-14"><a href="running-various-simulations.html#cb80-14" aria-hidden="true" tabindex="-1"></a>  games_sim1[game, ] <span class="ot">=</span> <span class="fu">sample</span>(die, <span class="at">size =</span> <span class="dv">4</span>, <span class="at">replace =</span> <span class="cn">TRUE</span>)</span>
<span id="cb80-15"><a href="running-various-simulations.html#cb80-15" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb80-16"><a href="running-various-simulations.html#cb80-16" aria-hidden="true" tabindex="-1"></a>wins_sim1 <span class="ot">=</span> <span class="fu">apply</span>(games_sim1, <span class="dv">1</span>, <span class="cf">function</span>(x) <span class="fu">any</span>(x <span class="sc">==</span> <span class="dv">6</span>))</span>
<span id="cb80-17"><a href="running-various-simulations.html#cb80-17" aria-hidden="true" tabindex="-1"></a>prop_wins_sim1 <span class="ot">=</span> <span class="fu">sum</span>(wins_sim1) <span class="sc">/</span> number_games</span>
<span id="cb80-18"><a href="running-various-simulations.html#cb80-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-19"><a href="running-various-simulations.html#cb80-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-20"><a href="running-various-simulations.html#cb80-20" aria-hidden="true" tabindex="-1"></a><span class="co"># simulation 2</span></span>
<span id="cb80-21"><a href="running-various-simulations.html#cb80-21" aria-hidden="true" tabindex="-1"></a>games_sim2 <span class="ot">=</span> <span class="fu">matrix</span>(<span class="dv">0</span>, <span class="at">nrow =</span> number_games, <span class="at">ncol =</span> <span class="dv">4</span>)</span>
<span id="cb80-22"><a href="running-various-simulations.html#cb80-22" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (game <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>number_games) {</span>
<span id="cb80-23"><a href="running-various-simulations.html#cb80-23" aria-hidden="true" tabindex="-1"></a>  games_sim2[game, ] <span class="ot">=</span> <span class="fu">sample</span>(die, <span class="at">size =</span> <span class="dv">4</span>, <span class="at">replace =</span> <span class="cn">TRUE</span>)</span>
<span id="cb80-24"><a href="running-various-simulations.html#cb80-24" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb80-25"><a href="running-various-simulations.html#cb80-25" aria-hidden="true" tabindex="-1"></a>wins_sim2 <span class="ot">=</span> <span class="fu">apply</span>(games_sim2, <span class="dv">1</span>, <span class="cf">function</span>(x) <span class="fu">any</span>(x <span class="sc">==</span> <span class="dv">6</span>))</span>
<span id="cb80-26"><a href="running-various-simulations.html#cb80-26" aria-hidden="true" tabindex="-1"></a>prop_wins_sim2 <span class="ot">=</span> <span class="fu">sum</span>(wins_sim2) <span class="sc">/</span> number_games</span>
<span id="cb80-27"><a href="running-various-simulations.html#cb80-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-28"><a href="running-various-simulations.html#cb80-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-29"><a href="running-various-simulations.html#cb80-29" aria-hidden="true" tabindex="-1"></a><span class="co"># simulation 3</span></span>
<span id="cb80-30"><a href="running-various-simulations.html#cb80-30" aria-hidden="true" tabindex="-1"></a>games_sim3 <span class="ot">=</span> <span class="fu">matrix</span>(<span class="dv">0</span>, <span class="at">nrow =</span> number_games, <span class="at">ncol =</span> <span class="dv">4</span>)</span>
<span id="cb80-31"><a href="running-various-simulations.html#cb80-31" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (game <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>number_games) {</span>
<span id="cb80-32"><a href="running-various-simulations.html#cb80-32" aria-hidden="true" tabindex="-1"></a>  games_sim3[game, ] <span class="ot">=</span> <span class="fu">sample</span>(die, <span class="at">size =</span> <span class="dv">4</span>, <span class="at">replace =</span> <span class="cn">TRUE</span>)</span>
<span id="cb80-33"><a href="running-various-simulations.html#cb80-33" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb80-34"><a href="running-various-simulations.html#cb80-34" aria-hidden="true" tabindex="-1"></a>wins_sim3 <span class="ot">=</span> <span class="fu">apply</span>(games_sim3, <span class="dv">1</span>, <span class="cf">function</span>(x) <span class="fu">any</span>(x <span class="sc">==</span> <span class="dv">6</span>))</span>
<span id="cb80-35"><a href="running-various-simulations.html#cb80-35" aria-hidden="true" tabindex="-1"></a>prop_wins_sim3 <span class="ot">=</span> <span class="fu">sum</span>(wins_sim3) <span class="sc">/</span> number_games</span>
<span id="cb80-36"><a href="running-various-simulations.html#cb80-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-37"><a href="running-various-simulations.html#cb80-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-38"><a href="running-various-simulations.html#cb80-38" aria-hidden="true" tabindex="-1"></a><span class="co"># summary: proportion of wins</span></span>
<span id="cb80-39"><a href="running-various-simulations.html#cb80-39" aria-hidden="true" tabindex="-1"></a><span class="fu">c</span>(<span class="st">&#39;sim1&#39;</span> <span class="ot">=</span> prop_wins_sim1,</span>
<span id="cb80-40"><a href="running-various-simulations.html#cb80-40" aria-hidden="true" tabindex="-1"></a>  <span class="st">&#39;sim2&#39;</span> <span class="ot">=</span> prop_wins_sim2,</span>
<span id="cb80-41"><a href="running-various-simulations.html#cb80-41" aria-hidden="true" tabindex="-1"></a>  <span class="st">&#39;sim3&#39;</span> <span class="ot">=</span> prop_wins_sim3)</span></code></pre></div>
<pre><code>## sim1 sim2 sim3 
##  0.4  0.2  0.8</code></pre>
<p>This piece of code has a lot of unnecessary redundancy. But let’s ignore this
fact for a second. In each simulation, we create a matrix <code>games_sim</code> to store
the rolls of each game. Then we use <code>apply()</code> to determine which games are wins
(<code>wins_sim</code>), and finally we calculate the proportion of wins (<code>prop_wins_sim</code>).</p>
<p>If you inspect the vectors <code>wins_sim1</code>, <code>wins_sim2</code>, and <code>wins_sim3</code>, you’ll
see that these are of <code>"logical"</code> data-type. <code>TRUE</code> means that a given game
is a win, whereas <code>FALSE</code> means lose.</p>
<p>Alternatively, instead of dealing with the logical vectors <code>wins_sim</code>, we
can convert their values into numbers: <code>1</code> instead of <code>TRUE</code>, and <code>-1</code> instead
of <code>FALSE</code>. Why do we need this change from logical to numbers? Quick
answer, you don’t really need it. But as we’ll see, working with <code>1</code> and <code>-1</code>
is more convenient later down the road when we calculate cumulative gains.</p>
<p>The diagram below depicts this idea of storing the end result of each game
into <code>1</code> (win) or <code>-1</code> (lose), for every simulation:</p>
<p><img src="images/demere-3-sims-loop.png" width="80%" style="display: block; margin: auto;" /></p>
<div id="embedded-for-loops" class="section level2 hasAnchor" number="6.1">
<h2><span class="header-section-number">6.1</span> Embedded <code>for()</code> loops<a href="running-various-simulations.html#embedded-for-loops" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Let’s take the preceding naive code and try to make it more compact. We are
going to use embedded <code>for()</code> loops: one of them to take care of the simulations,
and the other one to take care of the games.</p>
<p>The idea is to iterate through each simulation: 1, 2, and 3. And then, in a
given simulation, we iterate through each game: 1, 2, 3, 4, and 5.</p>
<div class="sourceCode" id="cb82"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb82-1"><a href="running-various-simulations.html#cb82-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">753</span>)</span>
<span id="cb82-2"><a href="running-various-simulations.html#cb82-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-3"><a href="running-various-simulations.html#cb82-3" aria-hidden="true" tabindex="-1"></a><span class="co"># main inputs</span></span>
<span id="cb82-4"><a href="running-various-simulations.html#cb82-4" aria-hidden="true" tabindex="-1"></a>die <span class="ot">=</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">6</span></span>
<span id="cb82-5"><a href="running-various-simulations.html#cb82-5" aria-hidden="true" tabindex="-1"></a>number_games <span class="ot">=</span> <span class="dv">5</span></span>
<span id="cb82-6"><a href="running-various-simulations.html#cb82-6" aria-hidden="true" tabindex="-1"></a>number_sims <span class="ot">=</span> <span class="dv">3</span></span>
<span id="cb82-7"><a href="running-various-simulations.html#cb82-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-8"><a href="running-various-simulations.html#cb82-8" aria-hidden="true" tabindex="-1"></a><span class="co"># matrix to store simulation outputs</span></span>
<span id="cb82-9"><a href="running-various-simulations.html#cb82-9" aria-hidden="true" tabindex="-1"></a>simulations <span class="ot">=</span> <span class="fu">matrix</span>(<span class="dv">0</span>, <span class="at">nrow =</span> number_games, <span class="at">ncol =</span> number_sims)</span>
<span id="cb82-10"><a href="running-various-simulations.html#cb82-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-11"><a href="running-various-simulations.html#cb82-11" aria-hidden="true" tabindex="-1"></a><span class="co"># 1st loop) iterate through each simulation</span></span>
<span id="cb82-12"><a href="running-various-simulations.html#cb82-12" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (sim <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>number_sims) {</span>
<span id="cb82-13"><a href="running-various-simulations.html#cb82-13" aria-hidden="true" tabindex="-1"></a>  games <span class="ot">=</span> <span class="fu">matrix</span>(<span class="dv">0</span>, <span class="at">nrow =</span> number_games, <span class="at">ncol =</span> <span class="dv">4</span>)</span>
<span id="cb82-14"><a href="running-various-simulations.html#cb82-14" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb82-15"><a href="running-various-simulations.html#cb82-15" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 2nd loop) iterate through each game</span></span>
<span id="cb82-16"><a href="running-various-simulations.html#cb82-16" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (game <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>number_games) {</span>
<span id="cb82-17"><a href="running-various-simulations.html#cb82-17" aria-hidden="true" tabindex="-1"></a>    games[game, ] <span class="ot">=</span> <span class="fu">sample</span>(die, <span class="at">size =</span> <span class="dv">4</span>, <span class="at">replace =</span> <span class="cn">TRUE</span>)</span>
<span id="cb82-18"><a href="running-various-simulations.html#cb82-18" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb82-19"><a href="running-various-simulations.html#cb82-19" aria-hidden="true" tabindex="-1"></a>  any_sixes <span class="ot">=</span> <span class="fu">apply</span>(games, <span class="dv">1</span>, <span class="cf">function</span>(x) <span class="fu">any</span>(x <span class="sc">==</span> <span class="dv">6</span>))</span>
<span id="cb82-20"><a href="running-various-simulations.html#cb82-20" aria-hidden="true" tabindex="-1"></a>  simulations[ ,sim] <span class="ot">=</span> <span class="fu">ifelse</span>(any_sixes, <span class="dv">1</span>, <span class="sc">-</span><span class="dv">1</span>)</span>
<span id="cb82-21"><a href="running-various-simulations.html#cb82-21" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb82-22"><a href="running-various-simulations.html#cb82-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-23"><a href="running-various-simulations.html#cb82-23" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(simulations) <span class="ot">=</span> <span class="fu">paste0</span>(<span class="st">&quot;game&quot;</span>, <span class="dv">1</span><span class="sc">:</span>number_games)</span>
<span id="cb82-24"><a href="running-various-simulations.html#cb82-24" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(simulations) <span class="ot">=</span> <span class="fu">paste0</span>(<span class="st">&quot;sim&quot;</span>, <span class="dv">1</span><span class="sc">:</span>number_sims)</span>
<span id="cb82-25"><a href="running-various-simulations.html#cb82-25" aria-hidden="true" tabindex="-1"></a>simulations</span></code></pre></div>
<pre><code>##       sim1 sim2 sim3
## game1    1   -1   -1
## game2    1    1    1
## game3   -1   -1    1
## game4   -1   -1    1
## game5   -1   -1    1</code></pre>
<p>What’s going on with this code? Before starting the iterations, we create a
matrix <code>simulations</code> which will store the numeric values of all games, and
all simulations. The rows of this matrix are associated to the games, and
the columns are associated to the simulations. At the end of the iterative
process, the cells of this matrix will be populated with either <code>1</code> (win game)
and <code>-1</code> (lose game).</p>
<p>The first <code>for()</code> loop—the <em>outer</em> loop—iterates through the simulations.
At the beginning of each simulation, an auxiliary <code>games</code> matrix is initialized,
which then gets populated in the embedded <code>for()</code> loop. This second <code>for()</code>
loop—the <em>inner</em> loop—iterates through the games, obtaining the rolls of
the five games. Right after the games are completed in the inner loop, we use
<code>apply()</code> to determine which games are wins (i.e. have at least one 6), and
then we convert the <code>TRUE</code>’s and <code>FALSE</code>’s into <code>1</code> and <code>-1</code>, respectively, by
using <code>ifelse()</code>. This numeric vector is stored in the corresponding column of
the <code>simulations</code> matrix.</p>
<p>Having obtained the matrix <code>simulations</code>, we then proceed to count the number
of wins <code>total_wins</code> (see code below). Notice the use of <code>apply()</code> to count the
number of wins for each column of <code>simulations</code>. The last step involves
computing the proportion of wins <code>prop_wins</code>:</p>
<div class="sourceCode" id="cb84"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb84-1"><a href="running-various-simulations.html#cb84-1" aria-hidden="true" tabindex="-1"></a>total_wins <span class="ot">=</span> <span class="fu">apply</span>(simulations, <span class="dv">2</span>, <span class="cf">function</span>(x) <span class="fu">sum</span>(x<span class="sc">==</span><span class="dv">1</span>))</span>
<span id="cb84-2"><a href="running-various-simulations.html#cb84-2" aria-hidden="true" tabindex="-1"></a>prop_wins <span class="ot">=</span> total_wins <span class="sc">/</span> number_games</span>
<span id="cb84-3"><a href="running-various-simulations.html#cb84-3" aria-hidden="true" tabindex="-1"></a>prop_wins</span></code></pre></div>
<pre><code>## sim1 sim2 sim3 
##  0.4  0.2  0.8</code></pre>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="playing-game1-100times.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="running-even-more-simulations.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["R-rolling-dice.pdf", "R-rolling-dice.epub"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
